{"version":3,"file":"sortvoting.min.js","sources":["../src/sortvoting.js"],"sourcesContent":["// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * AMD module used when saving a new sort voting.\n *\n * @module      mod_sortvoting/issues-list\n * @copyright   2023 Odei Alba <odeialba@odeialba.com>\n * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Notification from 'core/notification';\nimport Ajax from 'core/ajax';\n\nconst SELECTORS = {\n    SAVEVOTE: \"[data-action='savevote']\"\n};\n\n/**\n * Save sort vote.\n * @param {Element} saveSortVoteElement\n */\nconst saveVote = function(saveSortVoteElement) {\n    saveSortVoteElement.setAttribute('disabled', true);\n    var sortvotingid = document.getElementsByName('sortvotingid')[0].value;\n    var options = document.getElementsByName('option[]');\n\n    // Build votes and positions arrays for later processing.\n    var votes = [];\n    var positions = [];\n    options.forEach(function (option) {\n        positions.push(option.value);\n        votes.push({\n            'position': option.value,\n            'optionid': option.getAttribute('data-optionid')\n        });\n    });\n\n    // Check if all elements of the positions array are unique.\n    if (new Set(positions).size !== positions.length) {\n        window.alert('All positions must be unique');\n        saveSortVoteElement.removeAttribute('disabled');\n        return;\n    }\n\n    // Save vote.\n    var promises = Ajax.call([\n        {methodname: 'mod_sortvoting_save_vote', args: {sortvotingid: sortvotingid, votes: votes}}\n    ]);\n    promises[0].done(function() {\n        window.location.reload();\n    }).fail(Notification.exception);\n};\n\n/**\n * Init page\n */\nexport function init() {\n    document.addEventListener('click', event => {\n\n        // Save sort vote.\n        const saveSortVoteElement = event.target.closest(SELECTORS.SAVEVOTE);\n        if (saveSortVoteElement) {\n            event.preventDefault();\n            saveVote(saveSortVoteElement);\n        }\n    });\n}\n"],"names":["document","addEventListener","event","saveSortVoteElement","target","closest","SELECTORS","preventDefault","setAttribute","sortvotingid","getElementsByName","value","options","votes","positions","forEach","option","push","getAttribute","Set","size","length","window","alert","removeAttribute","Ajax","call","methodname","args","done","location","reload","fail","Notification","exception","saveVote"],"mappings":";;;;;;;sFAoEIA,SAASC,iBAAiB,SAASC,cAGzBC,oBAAsBD,MAAME,OAAOC,QAAQC,oBAC7CH,sBACAD,MAAMK,iBAzCD,SAASJ,qBACtBA,oBAAoBK,aAAa,YAAY,OACzCC,aAAeT,SAASU,kBAAkB,gBAAgB,GAAGC,MAC7DC,QAAUZ,SAASU,kBAAkB,YAGrCG,MAAQ,GACRC,UAAY,MAChBF,QAAQG,SAAQ,SAAUC,QACtBF,UAAUG,KAAKD,OAAOL,OACtBE,MAAMI,KAAK,UACKD,OAAOL,eACPK,OAAOE,aAAa,sBAKpC,IAAIC,IAAIL,WAAWM,OAASN,UAAUO,cACtCC,OAAOC,MAAM,qCACbpB,oBAAoBqB,gBAAgB,YAKzBC,cAAKC,KAAK,CACrB,CAACC,WAAY,2BAA4BC,KAAM,CAACnB,aAAcA,aAAcI,MAAOA,UAE9E,GAAGgB,MAAK,WACbP,OAAOQ,SAASC,YACjBC,KAAKC,sBAAaC,WAabC,CAAShC,wHAlDfG,mBACQ"}