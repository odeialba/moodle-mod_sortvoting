define("mod_sortvoting/sortvoting",["exports","core/notification","core/ajax","core/sortable_list","core/toast","jquery","core/str"],(function(_exports,_notification,_ajax,_sortable_list,_toast,_jquery,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * AMD module used when saving a new sort voting.
   *
   * @module      mod_sortvoting/sortvoting
   * @copyright   2023 Odei Alba <odeialba@odeialba.com>
   * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=function(){new _sortable_list.default("#sortvotinglist",{moveHandlerSelector:".optionitem"}),(0,_jquery.default)("ul#sortvotinglist > *").on(_sortable_list.default.EVENTS.DROP,(function(evt,info){if(info.positionChanged)for(var lis=info.sourceList[0].getElementsByTagName("li"),i=0;i<lis.length;i++)lis[i].getElementsByTagName("input")[0].value=i+1})),document.addEventListener("click",(event=>{const saveSortVoteElement=event.target.closest(SELECTORS_SAVEVOTE);saveSortVoteElement&&(event.preventDefault(),function(saveSortVoteElement){saveSortVoteElement.setAttribute("disabled",!0);var sortvotingid=document.getElementsByName("sortvotingid")[0].value,options=document.getElementsByName("option[]"),votes=[],positions=[];if(options.forEach((function(option){positions.push(option.value),votes.push({position:option.value,optionid:option.getAttribute("data-optionid")})})),new Set(positions).size!==positions.length)return(0,_toast.add)((0,_str.get_string)("errorduplicatedposition","mod_sortvoting"),{type:"danger"}),void saveSortVoteElement.removeAttribute("disabled");_ajax.default.call([{methodname:"mod_sortvoting_save_vote",args:{sortvotingid:sortvotingid,votes:votes}}])[0].done((function(result){result.success?(0,_toast.add)((0,_str.get_string)("votesuccess","mod_sortvoting"),{type:"success"}):(0,_toast.add)((0,_str.get_string)("voteerror","mod_sortvoting"),{type:"danger"}),result.seeresultsupdated?window.location.reload():result.allowupdate?saveSortVoteElement.removeAttribute("disabled"):(saveSortVoteElement.style.display="none",(0,_jquery.default)("ul#sortvotinglist > li.optionitem").each((function(index,element){element.classList.remove("optionitem","draggable"),element.classList.add("bg-gray-100"),element.removeAttribute("draggable"),element.removeAttribute("data-drag-type")})))})).fail(_notification.default.exception)}(saveSortVoteElement))}))},_notification=_interopRequireDefault(_notification),_ajax=_interopRequireDefault(_ajax),_sortable_list=_interopRequireDefault(_sortable_list),_jquery=_interopRequireDefault(_jquery);const SELECTORS_SAVEVOTE="[data-action='savevote']"}));

//# sourceMappingURL=sortvoting.min.js.map